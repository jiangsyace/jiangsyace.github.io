---
title: Linux中top命令参数详解
date: 2020-09-29
categories:
- tech
tags:
- linux
---

top命令经常用来监控linux的系统状况，是常用的性能分析工具，能够实时显示系统中各个进程的资源占用情况。

<!-- more -->

## top命令用法

### 语法

```
top [-d number] | top [-bnp]
```

### 参数说明

- -d：number代表秒数，表示top命令显示的页面更新一次的间隔。默认是5秒。   
- -b：以批次的方式执行top，搭配 "n" 参数一起使用，可以用来将 top 的结果输出到档案内 
- -c：切换显示模式，共有两种模式，一是只显示执行档的名称，另一种是显示完整的路径与名称S : 累积模式，会将己完成或消失的子行程 ( dead child process ) 的 CPU time 累积起来
- -s：安全模式，将交谈式指令取消, 避免潜在的危机
- -n：更新的次数，与-b配合使用，表示需要进行几次top命令的输出结果，完成后将会退出 top   
- -p：指定特定的pid进程号进行观察。  
- -i：不显示任何闲置 (idle) 或无用 (zombie) 的行程

在top命令显示的页面还可以输入以下按键执行相应的功能（注意大小写区分的）：

- ?：显示在top当中可以输入的命令  
- P：以CPU的使用资源排序显示  
- M：以内存的使用资源排序显示  
- N：以pid排序显示  
- T：由进程使用的时间累计排序显示  
- E：切换顶部的内存信息单位，只是切换数值不显示单位，每次切换转换率为1000，切换的单位为 k,m,g,t,p  
- e：切换底下的进程信息单位，每次切换转换率为1000，切换的单位也是 k,m,g,t,p  
- k：给某一个pid一个信号。可以用来杀死进程  
- r：给某个pid重新定制一个nice值（即优先级）  
- q：退出top（用ctrl+c也可以退出top）。  

### 使用实例

```
# 显示进程信息
> top

# 显示完整命令
> top -c

# 以批处理模式显示程序信息
> top -b

# 以累积模式显示程序信息
> top -S

# 设置信息更新次数，2表示更新两次后终止更新显示
> top -n 2

# 设置信息更新时间，3表示更新周期为3秒
> top -d 3

# 显示指定的进程信息
> top -p 139

# 显示进程号为139的进程信息，CPU、内存占用率等，显示更新十次后退出
> top -n 10

# 使用者将不能利用交谈式指令来对行程下命令
> top -s
```

## top输出参数含义

使用top命令来进行性能检测：

![](/assets/upload/2020-09/WX20200930-175523@2x.png)

### 前5行统计信息

**第1行：top - 17:55:17 up 43 days,  2:19,  4 users,  load average: 1.24, 0.88, 0.79**  
第1行是任务队列信息，其参数如下：  

| 内容                           | 含义                                                         |
| :----------------------------- | :----------------------------------------------------------- |
| 17:55:17                       | 表示当前时间                                                 |
| up 43 days,  2:19              | 系统运行时间                                                 |
| 4 users                        | 当前登录用户数                                               |
| load average: 1.24, 0.88, 0.79 | 系统负载，即任务队列的平均长度。三个数值分别为1分钟、5分钟、15分钟前到现在的平均值。 |

**load average**: 如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。 

**第2行：Tasks: 203 total,   1 running, 202 sleeping,   0 stopped,   0 zombie**  
**第3行：%Cpu(s):  3.9 us,  1.6 sy,  0.0 ni, 93.8 id,  0.0 wa,  0.0 hi,  0.8 si,  0.0 st**  
第2、3行为进程和CPU的信息，当有多个CPU时，这些内容可能会超过两行，其参数如下：  

| 内容         | 含义                                          |
| :----------- | :-------------------------------------------- |
| 203 total    | 进程总数                                      |
| 1 running    | 正在运行的进程数                              |
| 202 sleeping | 睡眠的进程数                                  |
| 0 stopped    | 停止的进程数                                  |
| 0 zombie     | 僵尸进程数                                    |
| 3.9 us       | 用户空间占用CPU百分比                         |
| 1.6 sy       | 内核空间占用CPU百分比                         |
| **0.0 ni**   | 用户进程空间内改变过优先级的进程占用CPU百分比 |
| 93.8 id      | 空闲CPU百分比                                 |
| 0.0 wa       | 等待输入输出的CPU时间百分比                   |
| **0.0 hi**   | 硬中断（Hardware IRQ）占用CPU的百分比         |
| **0.8 si**   | 软中断（Software Interrupts）占用CPU的百分比  |
| **0.0 st**   |                                               |


**第4行：KiB Mem : 32781556 total, 13005648 free, 10785488 used,  8990420 buff/cache**  
**第5行：KiB Swap:        0 total,        0 free,        0 used. 21380432 avail Mem**  
第4、5行为内存信息，其参数如下：  

| 内容                        | 含义                                   |
| :-------------------------- | :------------------------------------- |
| KiB Mem: 32781556 total     | 物理内存总量                           |
| 10785488 used                | 使用的物理内存总量                     |
| 13005648 free                  | 空闲内存总量                           |
| 8990420 buffers（buff/cache） | 用作内核缓存的内存量                   |
| KiB Swap: 0 total      | 交换区总量                             |
| 0 used                 | 使用的交换区总量                       |
| 0 free                 | 空闲交换区总量                         |
| 21380432 avail Mem           | 代表可用于进程下一次分配的物理内存数量 |

上述最后提到的缓冲的交换区总量，这里解释一下，所谓缓冲的交换区总量，即内存中的内容被换出到交换区，而后又被换入到内存，但使用过的交换区尚未被覆盖，该数值即为这些内容已存在于内存中的交换区的大小。相应的内存再次被换出时可不必再对交换区写入。 

计算可用内存数有一个近似的公式：   
第四行的free + 第四行的buffers + 第五行的cached

### 进程信息
| 列名    | 含义                                                         |
| :------ | :----------------------------------------------------------- |
| PID     | 进程id                                                       |
| PPID    | 父进程id                                                     |
| RUSER   | Real user name                                               |
| UID     | 进程所有者的用户id                                           |
| USER    | 进程所有者的用户名                                           |
| GROUP   | 进程所有者的组名                                             |
| TTY     | 启动进程的终端名。不是从终端启动的进程则显示为 ?             |
| PR      | 优先级                                                       |
| NI      | nice值。负值表示高优先级，正值表示低优先级                   |
| P       | 最后使用的CPU，仅在多CPU环境下有意义                         |
| %CPU    | 上次更新到现在的CPU时间占用百分比                            |
| TIME    | 进程使用的CPU时间总计，单位秒                                |
| TIME+   | 进程使用的CPU时间总计，单位1/100秒                           |
| %MEM    | 进程使用的物理内存百分比                                     |
| VIRT    | 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES                |
| SWAP    | 进程使用的虚拟内存中，被换出的大小，单位kb                   |
| RES     | 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA    |
| CODE    | 可执行代码占用的物理内存大小，单位kb                         |
| DATA    | 可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb    |
| SHR     | 共享内存大小，单位kb                                         |
| nFLT    | 页面错误次数                                                 |
| nDRT    | 最后一次写入到现在，被修改过的页面数。                       |
| S       | 进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程 |
| COMMAND | 命令名/命令行                                                |
| WCHAN   | 若该进程在睡眠，则显示睡眠中的系统函数名                     |
| Flags   | 任务标志                                                     |


top命令是一个非常强大的功能，但是它监控的最小单位是进程，如果想监控更小单位时，就需要用到ps或者netstate命令。

## 参考

[https://www.runoob.com/linux/linux-comm-top.html](https://www.runoob.com/linux/linux-comm-top.html)