---
title: 树莓派系统安装
date: 2018-3-13 22:11:12
categories:
- tech
---


树莓派3B安装新系统的步骤和一些问题，树莓派的架构是armhf

<!-- more -->

## 安装系统

第一步：准备工具

+ **SD卡格式化工具**  
  [SD Formatter 4.0 for SD/SDHC/SDXC](https://www.sdcard.org/downloads/formatter_4/)

+ **镜像烧录工具**  
  [Win32DiskImager v0.9.zip](http://sourceforge.net/projects/win32diskimager/files/Archive/win32diskimager-v0.9-binary.zip/download) ([sourceforge.net](http://sourceforge.net/projects/win32diskimager/))  
  [USB Image Tool](http://pan.baidu.com/share/link?shareid=4232180688&uk=605377859)（[使用介绍](http://shumeipai.nxez.com/2013/08/31/usb-image-tool.html)）

+ **操作系统**  

  **Raspbian**  
  树莓派官方深度定制的硬件驱动与软件程序，官方推荐系统。如果你第一次使用树莓派，请下载这个。Debian的软件策略偏保守，稳定第一，升级是次要的。  
  下载链接：[http://downloads.raspberrypi.org/raspbian_latest](http://downloads.raspberrypi.org/raspbian_latest)  
  默认帐号：Username: pi Password: raspberry

第二步：烧录系统  
用上面的SD卡格式化工具格式化SD卡，有人说直接用win10自己的格式化程序格式化成FAT32就好了，但是本人亲测不行，只能用这个工具格式化后才能用；然后是用Win32DiskImager往SD卡上烧系统，很傻瓜式的操作，选好系统镜像和SD卡路径直接点write就好了，其他选项忽略；

第三步：系统配置  
SD系统烧好后，先别拔，进入SD卡的boot根目录，新建一个ssh文件夹，或者新建一个名为ssh的空文件，不然新版系统的树莓派无法建立ssh连接。因为树莓派3b自带WiFi模块，所以有些小伙伴说可以直接往SD卡根目录里的cmdline文件里添加一句类似于“ip=192.168.137.9”这样的语句，方便后面找树莓派的ip地址。亲测确实能让树莓派显示这样的ip地址，但是新系统也自带着一个静态的ip地址，本人用的就是新系统自带的静态ip连接成功的。

第四步：连接系统  
查询树莓派ip后使用ssh工具连接，拿根网线将树莓派和笔记本网口连接，网口灯亮了就说明连通了，打开cmd，输入arp –a命令，正常的话可以看到两组ip；不知道树莓派ip在哪一组的话，可以拔了树莓派连接笔记本的网线，然后再用arp –a命令查看，哪个没了就是哪个了。

### wifi 设置
参考：[http://www.shumeipaiba.com/wanpai/jiaocheng/25.html](http://www.shumeipaiba.com/wanpai/jiaocheng/25.html)  
+ 查看周围的无线网络的ESSID(网络名称)、网络信息、信号强度  
```
pi@raspberrypi:~ $ sudo iwlist scan
pi@raspberrypi:~ $ sudo iwlist wlan0 scan | grep ESSID
```

+ 配置树莓派无线网络

  树莓派可以存储多个网络的信息，将常用的几个网络的ssid和psk配置好，一并存储即可，这样，当树莓派更换网络后也会自动连接

```
  # 编辑wifi文件
  pi@raspberrypi:~ $ sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
  # 在该文件最后添加下面的话
  network={
    ssid="WIFINAME"
    psk="password"
  }
  # 引号部分分别为wifi的名字和密码
  # 使用Ctrl+O来保存所做的修改 按Ctrl+X 退出
  # 保存文件后几秒钟应该就会自动连接到该wifi
  # 查看是否连接成功,如果连接成功会分配一个局域网ip
  pi@raspberrypi:~ $ ifconfig wlan0
  # 如果没有没有连接成功，尝试使用以下命令重启网络
  pi@raspberrypi:~$ sudo /etc/init.d/networking restart  #重启网络
  pi@raspberrypi:~$ sudo service networking restart      #重启网络
  pi@raspberrypi:~$ wpa_cli status                       #查看连接状态
  # 如果还是没有反应，重启树莓派`sudo reboot` 命令重启。

```

### 修改软件源

> 中国科学技术大学 Raspbian 
> [http://mirrors.ustc.edu.cn/raspbian/raspbian/](http://mirrors.ustc.edu.cn/raspbian/raspbian/)

```
# 该脚本适配最新的 2017-11-29-raspbian-stretch(基于Debian9)
pi@raspberrypi:~ $ sudo -s
pi@raspberrypi:~ $ sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
pi@raspberrypi:~ $ sudo cp /etc/apt/sources.list.d/raspi.list /etc/apt/sources.list.d/raspi.list.bak
pi@raspberrypi:~ $ echo -e "deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi \n deb-src http://mirrors.ustc.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi" > /etc/apt/sources.list
pi@raspberrypi:~ $ echo -e "deb http://mirrors.ustc.edu.cn/archive.raspberrypi.org/ stretch main ui" > /etc/apt/sources.list.d/raspi.list
pi@raspberrypi:~ $ exit
pi@raspberrypi:~ $ sudo apt update && sudo apt -y upgrade

# 修改为阿里云源
pi@raspberrypi:~ $ sudo echo -e "deb http://mirrors.aliyun.com/raspbian/raspbian/ stretch main contrib non-free rpi \n deb-src http://mirrors.aliyun.com/raspbian/raspbian/ stretch main contrib non-free rpi" > /etc/apt/sources.list
pi@raspberrypi:~ $ sudo cp /etc/apt/sources.list.d/raspi.list /etc/apt/sources.list.d/raspi.list.bak
pi@raspberrypi:~ $ sudo rm /etc/apt/sources.list.d/raspi.list

```

**其它源：( 并未测试！)**

> 中山大学 Raspbian  [http://mirror.sysu.edu.cn/raspbian/raspbian/](http://mirror.sysu.edu.cn/raspbian/raspbian/)  
> 清华大学 Raspbian  [http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/](http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/)  
> 华中科技大学 Raspbian  [http://mirrors.hustunique.com/raspbian/raspbian/](http://mirrors.hustunique.com/raspbian/raspbian/)   
> Linux ARM  [http://mirrors.hustunique.com/archlinuxarm/](http://mirrors.hustunique.com/archlinuxarm/)  
> 大连东软信息学院源（北方用户） Raspbian [http://mirrors.neusoft.edu.cn/raspbian/raspbian/](http://mirrors.neusoft.edu.cn/raspbian/raspbian/)  
> 重庆大学源（中西部用户） Raspbian  [http://mirrors.cqu.edu.cn/Raspbian/raspbian/](http://mirrors.cqu.edu.cn/Raspbian/raspbian/)  
> 阿里云 Raspbian   [http://mirrors.aliyun.com/raspbian/](http://mirrors.aliyun.com/raspbian/)  
>

### 设置时区

```
pi@raspberrypi:~ $ sudo dpkg-reconfigure tzdata

Package configuration

  ┌─────────────────────────┤ Configuring tzdata ├──────────────────────────┐
  │ Please select the geographic area in which you live. Subsequent         │
  │ configuration questions will narrow this down by presenting a list of   │
  │ cities, representing the time zones in which they are located.          │
  │                                                                         │
  │ Geographic area:                                                        │
  │                                                                         │
  │                          Africa                ↑                        │
  │                          America               ▒                        │
  │                          Antarctica            ▒                        │
  │                          Australia             ▒                        │
  │                          Arctic Ocean          ▒                        │
  │                          Asia                  ▒                        │
  │                          Atlantic Ocean        ▒                        │
  │                          Europe                ↓                        │
  │                                                                         │
  │                                                                         │
  │                   <Ok>                       <Cancel>                   │
  │                                                                         │
  └─────────────────────────────────────────────────────────────────────────┘
```

选择Asia>>chongqing或者shanghai   

### 常用命令

```
# 关机
pi@raspberrypi:~ $ sudo shutdown -h now
pi@raspberrypi:~ $ sudo poweroff
# 安装vim
pi@raspberrypi:~ $ sudo apt-get install -y vim
# 修改host
pi@raspberrypi:~ $ sudo vim /etc/hosts
```

## 安装软件

### Pi Dashboard

**Pi Dashboard**是树莓派实验室发布的一个开源的 IoT 设备监控工具，目前主要针对树莓派平台，也尽可能兼容其他类树莓派硬件产品。你只需要在树莓派上安装好 PHP 服务器环境，即可方便的部署一个 Pi 仪表盘，通过炫酷的 WebUI 来监控树莓派的状态！  
项目主页：[http://maker.quwj.com/project/10](http://maker.quwj.com/project/10)  
GitHub地址：[https://github.com/spoonysonny/pi-dashboard](https://github.com/spoonysonny/pi-dashboard)  
```
pi@raspberrypi:~ $ sudo apt-get install apache2
pi@raspberrypi:~ $ sudo apt-get install php7.0 php7.0-mysql
```

### sync

+ **在线安装**

Linux安装Sync [https://help.resilio.com/hc/en-us/articles/206178924](https://help.resilio.com/hc/en-us/articles/206178924)
```
  # Add repository
  pi@raspberrypi:~ $ sudo touch /etc/apt/sources.list.d/resilio-sync.list
  pi@raspberrypi:~ $ echo "deb http://linux-packages.resilio.com/resilio-sync/deb resilio-sync non-free" | sudo tee /etc/apt/sources.list.d/resilio-sync.list
    
  # Add public key
  pi@raspberrypi:~ $ wget -qO - https://linux-packages.resilio.com/resilio-sync/key.asc | sudo apt-key add -
  OR
  pi@raspberrypi:~ $ curl -LO http://linux-packages.resilio.com/resilio-sync/key.asc && sudo apt-key add ./key.asc
    
  # Install and update Sync
  pi@raspberrypi:~ $ sudo apt-get update
  pi@raspberrypi:~ $ sudo apt-get install resilio-sync
```
+   **离线安装**

  下载resilio-sync_armhf.tar.gz [https://www.resilio-sync.cn/download](https://www.resilio-sync.cn/download)
```
  # 解压
  pi@raspberrypi:~ $ sudo tar -zxvf resilio-sync_armhf.tar.gz
  # 运行
  pi@raspberrypi:~ $ cd /usr/local/sync #进入所在目录
  pi@raspberrypi:~ $ sudo ./rslsync --webui.listen 0.0.0.0:8888
```
  设置开机启动，创建脚本文件rslsync.sh，设置权限755，放入/etc/init.d目录  
```
  pi@raspberrypi:~ $ sudo vim /etc/init.d/rslsync.sh
    
  #!/bin/sh
  cd /usr/local/sync #进入软件所在目录
  ./rslsync --webui.listen 0.0.0.0:8888 #启动软件
  
  pi@raspberrypi:~ $ chmod 755 /etc/init.d/rslsync.sh
```

+ 使用命令

```
  # 创建同步目录和配置文件
  pi@raspberrypi:~ $ mkdir /home/sync
  pi@raspberrypi:~ $ chmod -R 755 /home/sync
  pi@raspberrypi:~ $ cd /home/sync
  pi@raspberrypi:~ $ rslsync --dump-sample-config > rslsync.conf
  # 载入配置文件
  pi@raspberrypi:~ $ rslsync --config /home/sync/rslsync.conf
  # 修改host
  pi@raspberrypi:~ $ sudo vim /etc/hosts
  127.0.0.1 license.resilio.com
```

### 搭建SAMBA服务器
#### 安装samba
```
pi@raspberrypi:~ $ sudo apt-get update
pi@raspberrypi:~ $ sudo apt-get install samba samba-common-bin
```
#### 创建共享目录/share，并更改目录权限 
```
pi@raspberrypi:~ $ sudo mkdir /share
pi@raspberrypi:~ $ sudo chmod 777 /share
```
#### 配置文件smb.conf  
```
pi@raspberrypi:~ $ sudo nano /etc/samba/smb.conf
```
在文件最后添加以下内容
```
# ======================
[share]               #共享文件的名称， 将在网络上以此名称显示
path = /share         #共享文件的路径
valid users = pi      #允许访问的用户
browseable = yes      #允许浏览
public = yes          #共享开放
writable = yes        #可写
```
Ctrl+O 保存, Ctrl+X 退出
#### 重启samba服务
```  
pi@raspberrypi:~ $ sudo /etc/init.d/samba restart
[ ok ] Stopping NetBIOS name server: nmbd.
[ ok ] Starting NetBIOS name server: nmbd.
[ ok ] Stopping SMB/CIFS daemon: smbd.
[ ok ] Starting SMB/CIFS daemon: smbd.
[ ok ] Stopping Samba AD DC daemon: samba.
```
#### 添加samba共享用户
```
pi@raspberrypi:~ $ sudo smbpasswd -a pi
New SMB password:

Retype new SMB password:
Added user pi.  
```
#### 测试samba共享  
Win + R 运行： \\10.10.10.103 (你的树莓派IP地址)
#### 映射网络驱动器  
\\10.10.10.103\share
