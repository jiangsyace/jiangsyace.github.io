<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<link href="/favicon.png" rel="icon" type="image/png" />
<script type="text/javascript" src="../../static/js/jquery-2.1.4.js"></script>
<script type="text/javascript" src="./jiangsy.watermark.js"></script>
<script type="text/javascript" src="./localResizeIMG/dist/lrz.bundle.js"></script>
<title>图片添加水印</title>
<style type="text/css">
body{
margin: 0px;
padding: 0px;
display: flex;
min-height: 100vh;
flex-direction: column;
}
.content{
flex: 1;
padding-bottom:15px;
}
#footer {
height: 15px;
margin-top: -15px;
color: #999;
font-family: Helvetica, Arial, sans-serif;
font-size: 11px;
clear:both;
}
</style>
</head>

<body>
    <div class="content">
        <input type="file" name="imgSrc" id="imgSrc"><br />
    </div>
    <div id="footer">
        Made by <a href="http://bins.top/blog">Jiangsy</a> <a href="http://bins.top/blog">blog</a>
    </div>
    <script>
        function readImgToBase64(img, callback) {
            var fr = new FileReader();
                fr.onload = function () {
                // $("#avatarPreview").attr('src', this.result);
                console.log(this.result);
                callback();
            };
            fr.readAsDataURL(img);
        }
        $(function(){
            //获取上传图片
            $('#imgSrc').on('change', function(){
                var img = $("#imgSrc")[0].files[0];
                //压缩图片
                lrz(img, {
                    width: 1000
                }).then(function (rst) {
                    // 处理成功会执行
                    watermarkBuilder(rst.base64);
                }).catch(function (err) {
                    // 处理失败会执行
                }).always(function () {
                    // 不管是成功失败，都会执行
                });
            });

            /**
             * 将Base64图片写入canvas并加入水印
             */
            function watermarkBuilder(imgBase64){
                //准备img对象
                var img = new Image();
                img.src = imgBase64;

                // 加载完成开始绘制
                img.onload = function () {
                    //准备canvas环境
                    // var cw = document.getElementById("imgCanvas");
                    // cw.width = img.width;
                    // cw.height = img.height;

                    // var ctx = cw.getContext("2d");


                    // 绘制图片
                    // ctx.drawImage(img, 0, 0);
                    // 绘制水印
                    // ctx.font = "20px microsoft yahei";
                    // ctx.fillStyle = "rgba(255,255,255,0.5)";
                    // ctx.fillText("my mark", 100, 100);


                    // ctx.font = "20px 黑体";
                    // ctx.rotate(-20*Math.PI/180);
                    // ctx.fillStyle = "rgba(100,100,100,0.1)";
                    // ctx.fillStyle = "rgba(255,255,255,0.5)";
                    // ctx.fillText("465dd92381", -20, 80); 
                    // ctx.rotate('20*Math.PI/180'); //坐标系还原



                    $('.content').watermark({
                        texts : ["仅供xx进行xx业务使用，他用无效——"], //水印文字
                        textColor : "#d2d2d2", //文字颜色
                        textFont : '24px 微软雅黑', //字体
                        width : 200, //水印文字的水平间距
                        height : 200, //水印文字的高度间距（低于文字高度会被替代）
                        textRotate : -30, //-90到0， 负数值，不包含-90
                        imgSrc : imgBase64
                    });

                }
            }
        });
    </script>
    <script type="text/javascript" src="../../static/js/hi.js" ></script>
</body>
</html>