<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<link href="/favicon.png" rel="icon" type="image/png" />
<script type="text/javascript" src="../../static/js/jquery-2.1.4.js"></script>
<title>图片添加水印</title>
<style type="text/css">
#footer {
bottom: 5px;
position: absolute;
color: #999;
font-family: Helvetica, Arial, sans-serif;
font-size: 11px;
}
</style>
</head>

<body>
    <input type="file" name="imgSrc" id="imgSrc"><br/>
    <canvas id="imgCanvas" width="100" height="100">
        Your browser does not support the HTML5 canvas tag.
    </canvas>
    <div id="footer">
        Made by <a href="http://bins.top/blog">Jiangsy</a> <a href="http://bins.top/blog">blog</a>
    </div>
    <script>
        $(function(){
            //获取上传图片
            $('#imgSrc').on('change', function(){
                var img = $("#imgSrc")[0].files[0];
                var fr = new FileReader();
                fr.onload = function () {
                    // $("#avatarPreview").attr('src', this.result);
                    console.log(this.result);

                    //准备img对象
                    var img = new Image();
                    img.src = this.result;

                    // 加载完成开始绘制
                    img.onload = function () {
                        //准备canvas环境
                        var canvas = document.getElementById("imgCanvas");
                        canvas.width = img.width;
                        canvas.height = img.height;

                        var ctx = canvas.getContext("2d");
                        // 绘制图片
                        ctx.drawImage(img, 0, 0);
                        // 绘制水印
                        ctx.font = "20px microsoft yahei";
                        ctx.fillStyle = "rgba(255,255,255,0.5)";
                        ctx.fillText("my mark", 100, 100);
                    }
                };
                fr.readAsDataURL(img);
            });
        });
    </script>
    <script type="text/javascript" src="../../static/js/hi.js" ></script>
</body>
</html>